<% content_for :headers do %>
  <%= stylesheet_link_tag "privacy.css", :media => "screen, projection" %>
  <%= stylesheet_link_tag "jquery.ui.slider.css", :media => "screen, projection" %>
  <%= stylesheet_link_tag "jquery.ui.slidertheme.css", :media => "screen, projection" %>
  <%= javascript_include_tag 'ui.checkbox'%>
  <%= javascript_include_tag 'privacy.js'%>
<% end %> 

<% toolbar :profile => current_subject, :option => 'contacts' %>


<script type="text/javascript">

  function checkBoxEnable(id) {
    $('div[contain$='+id+']').addClass("checked-option");

    if ($("#"+id).attr("optionOf")=="context"){			
      $(":checkbox[optionOf$=context]:checked:not(#"+id+")").checkBox('changeCheckStatus', false);
      $(":checkbox[optionOf$=level]:checked").checkBox('changeCheckStatus', false);
      $(":checkbox[optionOf$=permissions]:checked").checkBox('changeCheckStatus', false);

      var contextSelected = $('label[for$='+id+']').html();

      $.ajax({
        url: "<%= levels_path %>",
        context: document.body,
        data: { context: contextSelected },
        success: function(html){
          $("#privacy_levels").html(html);
          $('input').checkBox();
          initLevels();
          $("#privacy_levels").show();
          return true;
      }
  });
}

if ($("#"+id).attr("optionOf")=="level"){
  $(":checkbox[optionOf$=level]:checked:not(#"+id+")").checkBox('changeCheckStatus', false);
  $(":checkbox[optionOf$=permissions]:checked").checkBox('changeCheckStatus', false);

  var checkboxContextId = $(":checkbox[optionOf$=context]:checked").attr("id");
  var contextSelected = $('label[for$='+checkboxContextId+']').html();
  var levelSelected = $('label[for$='+id+']').html();

  var nlevel= levels.length;
  var index = levels.indexOf(levelSelected);
  var value = (100/nlevel)*(index+0.5);
  $("#slider-range").slider("values",1,value);
  $( "#level" ).val(levelSelected);

  $.ajax({
    url: "<%= permissions_path %>",
    context: document.body,
    data: { context: contextSelected, level: levelSelected },
    success: function(html){
      $("#privacy_permissions").html(html);
      $('input').checkBox();
      initPermissions();
      $("#privacy_levels").show();
      $("#privacy_permissions").show();
      return true;
    }
  });
}

if ($("#" + id).attr("optionOf") == "permissions") {
  refreshPrivacyRules();
}

}

function checkBoxDisable(id) {
  $('div[contain$='+id+']').removeClass("checked-option");

  if ($("#"+id).attr("optionOf")=="context"){
    $("#privacy_permissions").hide();
    $("#privacy_levels").hide();
  }

  if ($("#"+id).attr("optionOf")=="level"){     
    $("#privacy_permissions").hide();
  }

  if ($("#" + id).attr("optionOf") == "permissions") {
    refreshPrivacyRules();
  }
} 

function createContext(){
  $.ajax({
    url: "<%= privacy_path %>",
    context: document.body,
    data: { context: $("#new_context_input").val() },
    success: function(html){
      return true;
    }
  }); 
}

</script>

<div id="wrapper_section">   

  <p class="pageTitle"> Privacy & context </p>

  <div id="privacy_context" class="privacy_block_section first_block_section">
    <p class="sectionTitle"> 1. Choose context </p>

    <div class="privacy_add_element">
      <div id="new_context_title_block"> 
        <a href="#"><span id="new_context_title" class="privacy_span_new"> + New context </span></a>
      </div> 
      <div id="new_context_input_block"> 
        <%= render :partial => 'spheres/form' %>
      </div>
    </div>


    <div id="spheres">
      <%= render :partial => 'spheres/index' %>
    </div>

</div>


<div id="privacy_levels" class="privacy_block_section">
</div>


<div id="privacy_permissions" class="privacy_block_section">
</div>


    </div> 
