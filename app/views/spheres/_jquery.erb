var relations;
var relationsOrder;

function checkBoxId(id) {
  return id.match(/\d+$/)[0];
}

function checkBoxValue(id) {
  return $('label[for$=' + id +']').html(); 
}

function checkBoxOrder(id) {
  return parseInt($('label[for$=' + id +']').attr("order"));
}

function checkBoxIdByOrder(order) {
  return $('label[order$=' + order +']').attr("for");
}


function checkBoxEnable(id) {
	$('div[contain$='+id+']').addClass("checked-option");

	if ($("#"+id).attr("optionOf")=="sphere"){			
		$(":checkbox[optionOf$=sphere]:checked:not(#"+id+")").checkBox('changeCheckStatus', false);
                /*
		$(":checkbox[optionOf$=level]:checked").checkBox('changeCheckStatus', false);
		$(":checkbox[optionOf$=permissions]:checked").checkBox('changeCheckStatus', false);
                */

		var sphereSelected = checkBoxId(id);

		$.ajax({
			url: "<%= relations_path %>",
			context: document.body,
			data: { sphere_id: sphereSelected },
                        dataType: "script"
		});
	}

	if ($("#"+id).attr("optionOf")=="relation"){
		$(":checkbox[optionOf$=relation]:checked:not(#"+id+")").checkBox('changeCheckStatus', false);
                /*
		$(":checkbox[optionOf$=permissions]:checked").checkBox('changeCheckStatus', false);
                */

		var relationSelected = checkBoxId(id);
                var relationOrder = checkBoxOrder(id);

                var value = relations.length - checkBoxOrder(id) - 2;
		$("#slider-range").slider("value", value);
		$( "#relation" ).val(checkBoxValue(id));

		$.ajax({
			url: "<%= permissions_path %>",
			context: document.body,
			data: { relation_id: relationSelected },
                        dataType: "script"
		});
	}

	if ($("#" + id).attr("optionOf") == "permission") {
		refreshPrivacyRules();
	}

}

function checkBoxDisable(id) {
	$('div[contain$='+id+']').removeClass("checked-option");

	if ($("#"+id).attr("optionOf")=="sphere"){
		$("#permissions").hide();
		$("#relations").hide();
	}

	if ($("#"+id).attr("optionOf")=="relations"){     
		$("#permissions").hide();
	}

	if ($("#" + id).attr("optionOf") == "permissions") {
		refreshPrivacyRules();
	}
} 




function initSlider() {
  /* TODO: get relations from checkboxOptions */
  relations.unshift("<%= t 'relation.public.name' %>");
  relations.push("<%= t 'relation.me.name' %>");

  $("#relation").val(relations[relations.length - 1]);

  $("#slider-range").slider({
    orientation: "vertical",
    range: "min",
    min: 0,
    max: relations.length - 1,
    step: 1,
    value: relations.length - 1,
    slide: function(event, ui) {
      $('#relation').val(relations[ui.value]);
      },
    stop: function(event, ui) {
      var order = relations.length - ui.value - 2;
      if (order >= 0 && order < relations.length - 2) {
        var id = '#' + checkBoxIdByOrder(order);
        $(id).checkBox('changeCheckStatus', true);
      }
    }
  });
};

<%= render :partial => 'permissions/jquery' %>
